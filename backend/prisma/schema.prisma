generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  email     String   @unique
  password  String
  name      String?
  currency  String   @default("INR")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  profilePicture String?
  coverPicture   String?
  dateOfBirth    DateTime?
  bio            String?
  phoneNumber    String?

  // Password reset fields
  resetPasswordOtp       String?
  resetPasswordOtpExpiry DateTime?

  transactions Transaction[]
  budgets      Budget[]
  recurring    RecurringTransaction[]
  savings      Saving[]
}

model Transaction {
  id            String          @id @default(auto()) @map("_id") @db.ObjectId
  userId        String          @db.ObjectId
  title         String
  amount        Float
  type          TransactionType
  category      String // Storing category name or ID if we make a Category model
  paymentMethod PaymentMethod
  date          DateTime
  notes         String?
  location      String?
  tags          String[]
  isRecurring   Boolean         @default(false)
  invoiceUrl    String? // PDF invoice URL from Cloudinary
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt

  user  User              @relation(fields: [userId], references: [id])
  items TransactionItem[]
}

model Budget {
  id        String       @id @default(auto()) @map("_id") @db.ObjectId
  userId    String       @db.ObjectId
  category  String
  amount    Float
  period    BudgetPeriod @default(MONTHLY)
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt

  user User @relation(fields: [userId], references: [id])
}

model RecurringTransaction {
  id            String             @id @default(auto()) @map("_id") @db.ObjectId
  userId        String             @db.ObjectId
  title         String
  amount        Float
  type          TransactionType
  category      String
  paymentMethod PaymentMethod
  frequency     RecurringFrequency
  nextDueDate   DateTime
  daysOfWeek    Int[]              // 0=Sunday, 1=Monday, ..., 6=Saturday. Empty means all days
  isActive      Boolean            @default(true)
  createdAt     DateTime           @default(now())
  updatedAt     DateTime           @updatedAt

  user User @relation(fields: [userId], references: [id])
}

model Saving {
  id            String         @id @default(auto()) @map("_id") @db.ObjectId
  userId        String         @db.ObjectId
  title         String
  targetAmount  Float
  currentAmount Float          @default(0)
  category      SavingCategory @default(OTHER)
  priority      SavingPriority @default(MEDIUM)
  deadline      DateTime?
  notes         String?
  isCompleted   Boolean        @default(false)
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt

  user User @relation(fields: [userId], references: [id])
}

enum SavingCategory {
  EMERGENCY
  VACATION
  EDUCATION
  HOME
  CAR
  INVESTMENT
  RETIREMENT
  OTHER
}

enum SavingPriority {
  HIGH
  MEDIUM
  LOW
}

enum TransactionType {
  INCOME
  EXPENSE
}

enum PaymentMethod {
  CASH
  CARD
  UPI
  WALLET
  NET_BANKING
  OTHER
}

enum BudgetPeriod {
  DAILY
  WEEKLY
  MONTHLY
  YEARLY
}

enum RecurringFrequency {
  DAILY
  WEEKLY
  MONTHLY
  YEARLY
}

model TransactionItem {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  transactionId String   @db.ObjectId
  name          String
  quantity      Float
  price         Float
  createdAt     DateTime @default(now())

  transaction Transaction @relation(fields: [transactionId], references: [id], onDelete: Cascade)
}
